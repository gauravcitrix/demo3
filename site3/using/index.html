


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Citrix Hypervisor SDK">
      
      
        <link rel="canonical" href="https://developer-docs.citrix.com/using/">
      
      
      <link rel="shortcut icon" href="https://citrix.com/favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.1.0">
    
    
      
        <title>Using - Citrix Hypervisor SDK</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.d890a8da.min.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/palette.fdbf4049.min.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../assets/stylesheets/extra.css">
    
      <link rel="stylesheet" href="../css/excess.css">
    
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.1/css/all.css">
    
    
      
    
    
  </head>
  
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="blue">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#using-the-api" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://developer-docs.citrix.com" title="Citrix Hypervisor SDK"
      class="md-header-nav__button md-logo" aria-label="Citrix Hypervisor SDK">
      
      <img src="https://developer-docs.citrix.com/_static/Citrix_Logo_Black.png" width="75px" height="28.275px">
      
    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
      <span class="md-header-nav__topic">
        
      </span>
      <span class="md-header-nav__topic md-ellipsis">
        
        Citrix Hypervisor SDK
        
      </span>
    </div>
    
    </div>                       <!-  editing for  feedback ->
	 <a href="https://github.com/citrix-gaurav-yadav/exercise2/issues/new" id="citrix_feedback2" class="md-header-nav__button md-icon" title="Feedback"style="margin-right:30px;" >         
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 32C114.6 32 0 125.1 0 240c0 49.6 21.4 95 57 130.7C44.5 421.1 2.7 466 2.2 466.5c-2.2 2.3-2.8 5.7-1.5 8.7S4.8 480 8 480c66.3 0 116-31.8 140.6-51.4 32.7 12.3 69 19.4 107.4 19.4 141.4 0 256-93.1 256-208S397.4 32 256 32zM128 272c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128 0c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128 0c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"/></svg>
    </a>        
      <script>
	   var ft=document.getElementById("citrix_feedback2");
	   var tf=window.location.href;
	   tf=encodeURIComponent(tf);
	   var tmp="This is the URL of the page for which you  raised  the issue.";
	   var tmp1="Thanks for filing an issue.Please attach all the required information in detail.";
	   ft.href=ft.href+"?body="+tf+"%0A"+tmp+"%0A"+tmp1;
	   </script>	
    
    <label class="md-header-nav__button md-icon" for="__search">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
    </label>
    
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
    <div class="md-header-nav__source">
      
<a href="https://github.com/gauravcitrix/material/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Github
  </div>
</a>
    </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
          

<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href=".." class="md-tabs__link md-tabs__link--active">
        Introduction
      </a>
    
  </li>

      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    </ul>
  </div>
</nav>
        
                                <!- editing for feedback ->
	  	         <div class="rating"> 
                <h2>Was the article helpful?</h2>				 
                <!-- Thumbs up -->
               <div class="like grow">
            <a href="#"><i class="fa fa-thumbs-up fa-3x like"  aria-hidden="true"></i></a>
              </div>
              <!-- Thumbs down -->
            <div class="dislike grow">
             <a href="https://github.com/citrix-gaurav-yadav/exercise2/issues/new" id="like_dislike" onclick="feedbackloader(this.id);"><i class="fa fa-thumbs-down fa-3x dislike" aria-hidden="true"></i></a>
             </div>
             </div>		
			
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://developer-docs.citrix.com" title="Citrix Hypervisor SDK" class="md-nav__button md-logo" aria-label="Citrix Hypervisor SDK">
      
  <img src="https://developer-docs.citrix.com/_static/Citrix_Logo_Black.png" alt="logo">

    </a>
    Citrix Hypervisor SDK
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/gauravcitrix/material/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Github
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
	  
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

	  
    
	  
      
      
      


  <li class="md-nav__item">
    <a href="../overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

	  
    
	  
      
      
      


  <li class="md-nav__item">
    <a href="../getting-started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

	  
    
	  
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Using
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z" /></svg>
        </span>
      </label>
    
    <a href="./" title="Using" class="md-nav__link md-nav__link--active">
      Using
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#anatomy-of-a-typical-application" class="md-nav__link">
    Anatomy of a typical application
  </a>
  
    <nav class="md-nav" aria-label="Anatomy of a typical application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#choosing-a-low-level-transport" class="md-nav__link">
    Choosing a low-level transport
  </a>
  
    <nav class="md-nav" aria-label="Choosing a low-level transport">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#handling-pool-master-changes" class="md-nav__link">
    Handling pool master changes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication-and-session-handling" class="md-nav__link">
    Authentication and session handling
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finding-references-to-useful-objects" class="md-nav__link">
    Finding references to useful objects
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#invoking-synchronous-operations-on-objects" class="md-nav__link">
    Invoking synchronous operations on objects
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-tasks-to-manage-asynchronous-operations" class="md-nav__link">
    Using Tasks to manage asynchronous operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subscribing-to-and-listening-for-events" class="md-nav__link">
    Subscribing to and listening for events
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-application-examples" class="md-nav__link">
    Complete application examples
  </a>
  
    <nav class="md-nav" aria-label="Complete application examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simultaneously-migrating-vms-using-live-migration" class="md-nav__link">
    Simultaneously migrating VMs using live migration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloning-a-vm-using-the-xe-cli" class="md-nav__link">
    Cloning a VM using the xe CLI
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

	  
    
	  
      
      
      


  <li class="md-nav__item">
    <a href="../using-http/" title="Using HTTP" class="md-nav__link">
      Using HTTP
    </a>
  </li>

	  
    
	  
      
      
      


  <li class="md-nav__item">
    <a href="../xs-api-extensions/" title="Citrix Hypervisor Management API Extensions" class="md-nav__link">
      Citrix Hypervisor Management API Extensions
    </a>
  </li>

	  
    
	  
      
      
      


  <li class="md-nav__item">
    <a href="../xc-api-extensions/" title="XenCenter API Extension" class="md-nav__link">
      XenCenter API Extension
    </a>
  </li>

	  
    
	                           <!- editing  for feedback system ->
      <a href="https://github.com/citrix-gaurav-yadav/exercise2/issues/new" id="citrix_feedback1"  onclick="myfunc()" class="button6">Feedback</a>
	  
    
  </ul>
</nav>
                                  <!- editing  for feedback system ->
	   <script>
	   var ft=document.getElementById("citrix_feedback1");
	   var tf=window.location.href;
	   tf=encodeURIComponent(tf);
	   var tmp="This is the URL of the page for which you  raised  the issue.";
	   var tmp1="Thanks for filing an issue.Please attach all the required information in detail.";
	   ft.href=ft.href+"?body="+tf+"%0A"+tmp+"%0A"+tmp1;
	   </script>     
                  </div>
                </div>
              </div>
                               
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#anatomy-of-a-typical-application" class="md-nav__link">
    Anatomy of a typical application
  </a>
  
    <nav class="md-nav" aria-label="Anatomy of a typical application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#choosing-a-low-level-transport" class="md-nav__link">
    Choosing a low-level transport
  </a>
  
    <nav class="md-nav" aria-label="Choosing a low-level transport">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#handling-pool-master-changes" class="md-nav__link">
    Handling pool master changes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication-and-session-handling" class="md-nav__link">
    Authentication and session handling
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finding-references-to-useful-objects" class="md-nav__link">
    Finding references to useful objects
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#invoking-synchronous-operations-on-objects" class="md-nav__link">
    Invoking synchronous operations on objects
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-tasks-to-manage-asynchronous-operations" class="md-nav__link">
    Using Tasks to manage asynchronous operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subscribing-to-and-listening-for-events" class="md-nav__link">
    Subscribing to and listening for events
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-application-examples" class="md-nav__link">
    Complete application examples
  </a>
  
    <nav class="md-nav" aria-label="Complete application examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simultaneously-migrating-vms-using-live-migration" class="md-nav__link">
    Simultaneously migrating VMs using live migration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloning-a-vm-using-the-xe-cli" class="md-nav__link">
    Cloning a VM using the xe CLI
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/gauravcitrix/material/edit/master/docs/using.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" /></svg>
                  </a>
                
                
                  
                
                
                <h1 id="using-the-api">Using the API<a class="headerlink" href="#using-the-api" title="Permanent link">&para;</a></h1>
<p>This chapter describes how to use the Citrix Hypervisor Management API from
real programs to manage Citrix Hypervisor servers and VMs. The chapter begins
with a walk-through of a typical client application and demonstrates how
the API can be used to perform common tasks. Example code fragments are
given in python syntax but equivalent code in the other programming
languages would look very similar. The chapter finishes with
walk-throughs of two complete examples.</p>
<h2 id="anatomy-of-a-typical-application">Anatomy of a typical application<a class="headerlink" href="#anatomy-of-a-typical-application" title="Permanent link">&para;</a></h2>
<p>This section describes the structure of a typical application using the
Citrix Hypervisor Management API. Most client applications begin by
connecting to a Citrix Hypervisor server and authenticating (for example,  with a
username and password). Assuming the authentication succeeds, the server
will create a "session" object and return a reference to the client.
This reference will be passed as an argument to all future API calls.
Once authenticated, the client may search for references to other useful
objects (for example,  Citrix Hypervisor servers, VMs, etc.) and invoke operations on
them. Operations may be invoked either synchronously or asynchronously;
special task objects represent the state and progress of asynchronous
operations. These application elements are all described in detail in
the following sections.</p>
<h3 id="choosing-a-low-level-transport">Choosing a low-level transport<a class="headerlink" href="#choosing-a-low-level-transport" title="Permanent link">&para;</a></h3>
<p>API calls can be issued over two transports:</p>
<ul>
<li>
<p>SSL-encrypted TCP on port 443 (https) over an IP network</p>
</li>
<li>
<p>plaintext over a local Unix domain socket: <code>/var/xapi/xapi</code></p>
</li>
</ul>
<p>Switching from the XML-RPC to the JSON-RPC backend can be done by adding the suffix <code>/jsonrpc</code> to the host URL path.</p>
<p>The SSL-encrypted TCP transport is used for all off-host traffic while the Unix domain socket can be used from services running directly on the Citrix Hypervisor server itself. In the SSL-encrypted TCP transport, all API calls should be directed at the Resource Pool master; failure to do so will result in the error <code>HOST_IS_SLAVE</code>, which includes the IP address of the master as an error parameter.</p>
<p>Because the master host of a pool can change, especially if HA is enabled on a pool, clients must implement the following steps to detect a master host change and connect to the new master as required:</p>
<h4 id="handling-pool-master-changes">Handling pool master changes<a class="headerlink" href="#handling-pool-master-changes" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p>Subscribe to updates in the list of hosts servers, and maintain a current list of hosts in the pool</p>
</li>
<li>
<p>If the connection to the pool master fails to respond, attempt to connect to all hosts in the list until one responds</p>
</li>
<li>
<p>The first host to respond will return the <code>HOST_IS_SLAVE</code> error message, which contains the identity of the new pool master (unless of course the host is the new master)</p>
</li>
<li>
<p>Connect to the new master</p>
</li>
</ol>
<blockquote>
<p><strong>Note</strong></p>
<p>As a special-case, all messages sent through the Unix domain socket
are transparently forwarded to the correct node.</p>
</blockquote>
<h3 id="authentication-and-session-handling">Authentication and session handling<a class="headerlink" href="#authentication-and-session-handling" title="Permanent link">&para;</a></h3>
<p>The vast majority of API calls take a session reference as their first
parameter; failure to supply a valid reference will result in a
<code>SESSION_INVALID</code> error being returned. Acquire a session reference by
supplying a username and password to the <code>login_with_password</code> function.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>As a special-case, if this call is executed over the local Unix domain
socket then the username and password are ignored and the call always
succeeds.</p>
</blockquote>
<p>Every session has an associated "last active" timestamp which is updated
on every API call. The server software currently has a built-in limit of
500 active sessions and will remove those with the oldest "last active"
field if this limit is exceeded for a given <code>username</code> or <code>originator</code>.
In addition all sessions whose "last active" field is older than 24
hours are also removed. Therefore it is important to:</p>
<ul>
<li>
<p>Specify an appropriate <code>originator</code> when logging in; and</p>
</li>
<li>
<p>Remember to log out of active sessions to avoid leaking them; and</p>
</li>
<li>
<p>Be prepared to log in again to the server if a <code>SESSION_INVALID</code>
    error is caught.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong> A session reference obtained by a login request to the XML-RPC backend can be used in subsequent requests to the JSON-RPC backend, and vice-versa.</p>
</blockquote>
<p>In the following Python fragment a connection is established over the
Unix domain socket and a session is created:</p>
<pre><code class="python">    import XenAPI

    session = XenAPI.xapi_local()
    try:
      session.xenapi.login_with_password(&quot;root&quot;, &quot;&quot;, &quot;2.3&quot;, &quot;My Widget v0.1&quot;)
      ...
    finally:
      session.xenapi.session.logout()
</code></pre>

<h3 id="finding-references-to-useful-objects">Finding references to useful objects<a class="headerlink" href="#finding-references-to-useful-objects" title="Permanent link">&para;</a></h3>
<p>Once an application has authenticated the next step is to acquire
references to objects in order to query their state or invoke operations
on them. All objects have a set of "implicit" messages which include the
following:</p>
<ul>
<li>
<p><code>get_by_name_label</code> : return a list of all objects of a particular
    class with a particular label;</p>
</li>
<li>
<p><code>get_by_uuid</code> : return a single object named by its UUID;</p>
</li>
<li>
<p><code>get_all</code> : return a set of references to all objects of a
    particular class; and</p>
</li>
<li>
<p><code>get_all_records</code> : return a map of reference to records for each
    object of a particular class.</p>
</li>
</ul>
<p>For example, to list all hosts:</p>
<pre><code class="python">    hosts = session.xenapi.host.get_all()
</code></pre>

<p>To find all VMs with the name "my first VM":</p>
<pre><code class="python">    vms = session.xenapi.VM.get_by_name_label('my first VM')
</code></pre>

<blockquote>
<p><strong>Note</strong></p>
<p>Object <code>name_label</code> fields are not guaranteed to be unique and so the
<code>get_by_name_label</code> API call returns a set of references rather than a
single reference.</p>
</blockquote>
<p>In addition to the methods of finding objects described above, most
objects also contain references to other objects within fields. For
example it is possible to find the set of VMs running on a particular
host by calling:</p>
<pre><code class="python">    vms = session.xenapi.host.get_resident_VMs(host)
</code></pre>

<h3 id="invoking-synchronous-operations-on-objects">Invoking synchronous operations on objects<a class="headerlink" href="#invoking-synchronous-operations-on-objects" title="Permanent link">&para;</a></h3>
<p>Once object references have been acquired, operations may be invoked on
them. For example to start a VM:</p>
<pre><code class="python">    session.xenapi.VM.start(vm, False, False)
</code></pre>

<p>All API calls are by default synchronous and will not return until the
operation has completed or failed. For example in the case of <code>VM.start</code>
the call does not return until the VM has started booting.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>When the <code>VM.start</code> call returns the VM will be booting. To determine
when the booting has finished, wait for the in-guest agent to report
internal statistics through the <code>VM_guest_metrics</code> object.</p>
</blockquote>
<h3 id="using-tasks-to-manage-asynchronous-operations">Using Tasks to manage asynchronous operations<a class="headerlink" href="#using-tasks-to-manage-asynchronous-operations" title="Permanent link">&para;</a></h3>
<p>To simplify managing operations which take quite a long time (for example,
<code>VM.clone</code> and <code>VM.copy</code>) functions are available in two forms:
synchronous (the default) and asynchronous. Each asynchronous function
returns a reference to a task object which contains information about
the in-progress operation including:</p>
<ul>
<li>
<p>whether it is pending</p>
</li>
<li>
<p>whether it is has succeeded or failed</p>
</li>
<li>
<p>progress (in the range 0-1)</p>
</li>
<li>
<p>the result or error code returned by the operation</p>
</li>
</ul>
<p>An application which wanted to track the progress of a <code>VM.clone</code>
operation and display a progress bar would have code like the following:</p>
<pre><code class="python">    vm = session.xenapi.VM.get_by_name_label('my vm')
    task = session.xenapi.Async.VM.clone(vm)
    while session.xenapi.task.get_status(task) == &quot;pending&quot;:
      progress = session.xenapi.task.get_progress(task)
      update_progress_bar(progress)
      time.sleep(1)
    session.xenapi.task.destroy(task)
</code></pre>

<blockquote>
<p><strong>Note</strong></p>
<p>Note that a well-behaved client should remember to delete tasks
created by asynchronous operations when it has finished reading the
result or error. If the number of tasks exceeds a built-in threshold
then the server will delete the oldest of the completed tasks.</p>
</blockquote>
<h3 id="subscribing-to-and-listening-for-events">Subscribing to and listening for events<a class="headerlink" href="#subscribing-to-and-listening-for-events" title="Permanent link">&para;</a></h3>
<p>With the exception of the task and metrics classes, whenever an object
is modified the server generates an event. Clients can subscribe to this
event stream on a per-class basis and receive updates rather than
resorting to frequent polling. Events come in three types:</p>
<ul>
<li>
<p><code>add</code> - generated when an object has been created;</p>
</li>
<li>
<p><code>del</code> - generated immediately before an object is destroyed; and</p>
</li>
<li>
<p><code>mod</code> - generated when an object's field has changed.</p>
</li>
</ul>
<p>Events also contain a monotonically increasing ID, the name of the class
of object and a snapshot of the object state equivalent to the result of
a <code>get_record()</code>.</p>
<p>Clients register for events by calling <code>event.register()</code> with a list of
class names or the special string "*". Clients receive events by
executing <code>event.next()</code> which blocks until events are available and
returns the new events.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>Since the queue of generated events on the server is of finite length
a very slow client might fail to read the events fast enough; if this
happens an <code>EVENTS_LOST</code> error is returned. Clients should be prepared
to handle this by re-registering for events and checking that the
condition they are waiting for hasn't become true while they were
unregistered.</p>
</blockquote>
<p>The following Python code fragment demonstrates how to print a summary
of every event generated by a system: (similar code exists in <code>CitrixHypervisor-SDK/XenServerPython/samples/watch-all-events.py</code>)</p>
<pre><code class="python">    fmt = &quot;%8s %20s %5s %s&quot;
    session.xenapi.event.register([&quot;*&quot;])
      while True:
        try:
          for event in session.xenapi.event.next():
            name = &quot;(unknown)&quot;
            if &quot;snapshot&quot; in event.keys():
              snapshot = event[&quot;snapshot&quot;]
              if &quot;name_label&quot; in snapshot.keys():
                name = snapshot[&quot;name_label&quot;]
            print fmt % (event['id'], event['class'], event['operation'], name)
        except XenAPI.Failure, e:
          if e.details == [ &quot;EVENTS_LOST&quot; ]:
            print &quot;Caught EVENTS_LOST; should reregister&quot;
</code></pre>

<h2 id="complete-application-examples">Complete application examples<a class="headerlink" href="#complete-application-examples" title="Permanent link">&para;</a></h2>
<p>This section describes two complete examples of real programs using the API.</p>
<h3 id="simultaneously-migrating-vms-using-live-migration">Simultaneously migrating VMs using live migration<a class="headerlink" href="#simultaneously-migrating-vms-using-live-migration" title="Permanent link">&para;</a></h3>
<p>This python example (contained in <code>CitrixHypervisor-SDK/XenServerPython/samples/permute.py</code>)
demonstrates how to use live migration to move VMs simultaneously between
hosts in a Resource Pool. The example makes use of asynchronous API
calls and shows how to wait for a set of tasks to complete.</p>
<p>The program begins with some standard boilerplate and imports the API module</p>
<pre><code class="python">    import sys, time
    import XenAPI
</code></pre>

<p>Next the commandline arguments containing a server URL, username,
password and a number of iterations are parsed. The username and
password are used to establish a session which is passed to the function
<code>main</code>, which is called multiple times in a loop. Note the use of
<code>try: finally:</code> to make sure the program logs out of its session at the
end.</p>
<pre><code class="python">    if __name__ == &quot;__main__&quot;:
        if len(sys.argv) &lt;&gt; 5:
            print &quot;Usage:&quot;
            print sys.argv[0], &quot; &lt;url&gt; &lt;username&gt; &lt;password&gt; &lt;iterations&gt;&quot;
            sys.exit(1)
        url = sys.argv[1]
        username = sys.argv[2]
        password = sys.argv[3]
        iterations = int(sys.argv[4])
        # First acquire a valid session by logging in:
        session = XenAPI.Session(url)
        session.xenapi.login_with_password(username, password, &quot;2.3&quot;,
                                           &quot;Example migration-demo v0.1&quot;)
        try:
            for i in range(iterations):
                main(session, i)
        finally:
            session.xenapi.session.logout()
</code></pre>

<p>The <code>main</code> function examines each running VM in the system, taking care
to filter out <em>control domains</em> (which are part of the system and not
controllable by the user). A list of running VMs and their current hosts
is constructed.</p>
<pre><code class="python">    def main(session, iteration):
        # Find a non-template VM object
        all = session.xenapi.VM.get_all()
        vms = []
        hosts = []
        for vm in all:
            record = session.xenapi.VM.get_record(vm)
            if not(record[&quot;is_a_template&quot;]) and \
               not(record[&quot;is_control_domain&quot;]) and \
               record[&quot;power_state&quot;] == &quot;Running&quot;:
                vms.append(vm)
                hosts.append(record[&quot;resident_on&quot;])
        print &quot;%d: Found %d suitable running VMs&quot; % (iteration, len(vms))
</code></pre>

<p>Next the list of hosts is rotated:</p>
<pre><code class="python">    # use a rotation as a permutation
        hosts = [hosts[-1]] + hosts[:(len(hosts)-1)]
</code></pre>

<p>Each VM is then moved using live migration to the new host under this
rotation (i.e. a VM running on host at position 2 in the list will be
moved to the host at position 1 in the list etc.) In order to execute
each of the movements in parallel, the asynchronous version of the
<code>VM.pool_migrate</code> is used and a list of task references constructed.
Note the <code>live</code> flag passed to the <code>VM.pool_migrate</code>; this causes the VMs to be moved while they
are still running.</p>
<pre><code>tasks = []
    for i in range(0, len(vms)):
        vm = vms[i]
        host = hosts[i]
        task = session.xenapi.Async.VM.pool_migrate(vm, host, { "live": "true" })
        tasks.append(task)
</code></pre>
<p>The list of tasks is then polled for completion:</p>
<pre><code>finished = False
    records = {}
    while not(finished):
        finished = True
        for task in tasks:
            record = session.xenapi.task.get_record(task)
            records[task] = record
            if record["status"] == "pending":
                finished = False
        time.sleep(1)
</code></pre>
<p>Once all tasks have left the <em>pending</em> state (i.e. they have
successfully completed, failed or been cancelled) the tasks are polled
once more to see if they all succeeded:</p>
<pre><code>allok = True
    for task in tasks:
        record = records[task]
        if record["status"] &lt;&gt; "success":
            allok = False
</code></pre>
<p>If any one of the tasks failed then details are printed, an exception is
raised and the task objects left around for further inspection. If all
tasks succeeded then the task objects are destroyed and the function
returns.</p>
<pre><code>if not(allok):
        print "One of the tasks didn't succeed at", \
            time.strftime("%F:%HT%M:%SZ", time.gmtime())
        idx = 0
        for task in tasks:
            record = records[task]
            vm_name = session.xenapi.VM.get_name_label(vms[idx])
            host_name = session.xenapi.host.get_name_label(hosts[idx])
            print "%s : %12s %s -&gt; %s [ status: %s; result = %s; error = %s ]" % \
                  (record["uuid"], record["name_label"], vm_name, host_name,      \
                   record["status"], record["result"], repr(record["error_info"]))
            idx = idx + 1
        raise "Task failed"
    else:
        for task in tasks:
            session.xenapi.task.destroy(task)
</code></pre>
<h3 id="cloning-a-vm-using-the-xe-cli">Cloning a VM using the xe CLI<a class="headerlink" href="#cloning-a-vm-using-the-xe-cli" title="Permanent link">&para;</a></h3>
<p>This example is a <code>bash</code> script which uses the xe CLI to clone a VM
taking care to shut it down first if it is powered on.</p>
<p>The example begins with some boilerplate which first checks if the
environment variable <code>XE</code> has been set: if it has it assumes that it
points to the full path of the CLI, else it is assumed that the xe CLI
is on the current path. Next the script prompts the user for a server
name, username and password:</p>
<pre><code># Allow the path to the 'xe' binary to be overridden by the XE environment variable
if [ -z "${XE}" ]; then
  XE=xe
fi

if [ ! -e "${HOME}/.xe" ]; then
  read -p "Server name: " SERVER
  read -p "Username: " USERNAME
  read -p "Password: " PASSWORD
  XE="${XE} -s ${SERVER} -u ${USERNAME} -pw ${PASSWORD}"
fi
</code></pre>
<p>Next the script checks its commandline arguments. It requires exactly
one: the UUID of the VM which is to be cloned:</p>
<pre><code># Check if there's a VM by the uuid specified
${XE} vm-list params=uuid | grep -q " ${vmuuid}$"
if [ $? -ne 0 ]; then
        echo "error: no vm uuid \"${vmuuid}\" found"
        exit 2
fi
</code></pre>
<p>The script then checks the power state of the VM and if it is running,
it attempts a clean shutdown. The event system is used to wait for the
VM to enter state "Halted".</p>
<blockquote>
<p><strong>Note</strong></p>
<p>The xe CLI supports a command-line argument <code>--minimal</code> which causes
it to print its output without excess whitespace or formatting, ideal
for use from scripts. If multiple values are returned they are
comma-separated.</p>
</blockquote>
<pre><code># Check the power state of the vm
name=$(${XE} vm-list uuid=${vmuuid} params=name-label --minimal)
state=$(${XE} vm-list uuid=${vmuuid} params=power-state --minimal)
wasrunning=0

# If the VM state is running, we shutdown the vm first
if [ "${state}" = "running" ]; then
        ${XE} vm-shutdown uuid=${vmuuid}
        ${XE} event-wait class=vm power-state=halted uuid=${vmuuid}
        wasrunning=1
fi
</code></pre>
<p>The VM is then cloned and the new VM has its <code>name_label</code> set to
<code>cloned_vm</code>.</p>
<pre><code># Clone the VM
newuuid=$(${XE} vm-clone uuid=${vmuuid} new-name-label=cloned_vm)
</code></pre>
<p>Finally, if the original VM had been running and was shutdown, both it
and the new VM are started.</p>
<pre><code># If the VM state was running before cloning, we start it again
# along with the new VM.
if [ "$wasrunning" -eq 1 ]; then
        ${XE} vm-start uuid=${vmuuid}
        ${XE} vm-start uuid=${newuuid}
fi
</code></pre>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>  
	                                               <!- editing for feedback ->
	  	  
	   <div class="feedback">
       <a href="https://github.com/citrix-gaurav-yadav/exercise2/issues/new" id="citrix_feedback"  style="margin-bottom:20px; padding:10px;"onclick="myfunc();feedbackloader(this.id);" class="button6">Feedback</a>
       </div>
	  
	   <script>
	   function feedbackloader(id)
	   {
	   var ft=document.getElementById(id);
	   var tf=window.location.href;
	   tf=encodeURIComponent(tf);
	   var tmp="This is the URL of the page for which you  raised  the issue.";
	   var tmp1="Thanks for filing an issue.Please attach all the required information in detail.";
	   ft.href=ft.href+"?body="+tf+"%0A"+tmp+"%0A"+tmp1;
	   }
	   </script>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../getting-started/" title="Getting Started" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Getting Started
              </div>
            </div>
          </a>
        
        
          <a href="../using-http/" title="Using HTTP" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Using HTTP
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" /></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 1999-2020 Citrix Systems, Inc. All rights reserved. 
          </div>
        
        <!---Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>-->
      </div>
      
  <div class="md-footer-social">
    
      
      
      <a href="https://www.youtube.com/channel/UCiOupk9QF6jdk3EDKTHDykA" target="_blank" rel="noopener" title="www.youtube.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
      </a>
    
      
      
      <a href="https://github.com/citrix" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
      
      
      <a href="https://twitter.com/citrixdeveloper" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
      
      
      <a href="https://www.linkedin.com/company/citrix/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.606193c2.min.js"></script>
      <script src="../assets/javascripts/bundle.7af7e239.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: {"tabs": false},
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.7f7c8775.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="../js/tmp.js"></script>
      
    
  </body>
</html>